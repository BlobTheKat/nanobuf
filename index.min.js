globalThis.TypedArray??=Object.getPrototypeOf(Int8Array);const{floor:t,trunc:i,fround:e}=Math,A="0123456789abcdef",E=(t,i,e,s)=>(t.encode=i,t.decode=e,t.size=s,t);export class BufReader extends DataView{i=0;constructor(t){t instanceof ArrayBuffer?super(t):super(t.buffer,t.byteOffset,t.byteLength)}decode(t,i){return t.decode(this,i)}u8(){try{return this.getUint8(this.i++)}catch{return 0}}i8(){try{return this.getInt8(this.i++)}catch{return 0}}u16(){try{return this.getUint16((this.i+=2)-2)}catch{return 0}}i16(){try{return this.getInt16((this.i+=2)-2)}catch{return 0}}u32(){try{return this.getUint32((this.i+=4)-4)}catch{return 0}}i32(){try{return this.getInt32((this.i+=4)-4)}catch{return 0}}u64(){try{return 4294967296*this.getUint32((this.i+=8)-8)+this.getUint32(this.i-4)}catch{return 0}}i64(){try{return 4294967296*this.getInt32((this.i+=8)-8)+this.getUint32(this.i-4)}catch{return 0}}bu64(){try{return this.getBigUint64((this.i+=8)-8)}catch{return 0}}bi64(){try{return this.getBigInt64((this.i+=8)-8)}catch{return 0}}f32(){try{return this.getFloat32((this.i+=4)-4)}catch{return 0}}f64(){try{return this.getFloat64((this.i+=8)-8)}catch{return 0}}bool(){try{return 0!=this.getUint8(this.i++)}catch{return 0}}v64(){try{let t=this.getUint8(this.i++);if(t<64)return t;if(t>=128)return(2147483647&this.getUint32((this.i+=7)-8))*4294967296+this.getUint32(this.i-4);if(t>=96)return 536870911&this.getUint32((this.i+=3)-4);return this.getUint8(this.i++)|t<<8&8191}catch{return 0}}bv64(){try{let t=this.getUint8(this.i++);if(t>=64){if(t>=128)return 0x7fffffffffffffffn&this.getBigUint64((this.i+=7)-8);t=t>=96?536870911&this.getUint32((this.i+=3)-4):this.getUint8(this.i++)|t<<8&8191}return BigInt(t)}catch{return 0}}v32(){try{let t=this.getUint8(this.i++);if(t<64)return t;if(t>=128)return 2147483647&this.getUint32((this.i+=3)-4);return this.getUint8(this.i++)|t<<8&16383}catch{return 0}}v16(){try{let t=this.getUint8(this.i++);return t<128?t:this.getUint8(this.i++)|t<<8&16383}catch{return 0}}skip(t){this.i+=t}u8arr(t=-1){try{let i=this.i;return t<0&&(t=this.getUint8(i++))>=64&&(t>=128?(t=2147483647&this.getUint32(i),i+=3):t=this.getUint8(this.i++)|n<<8&16383),this.i=i+t,new Uint8Array(this.buffer.slice(i+=this.byteOffset,t))}catch{return new Uint8Array}}str(){let t=this.i,i=this.getUint8(t++);return i>=64&&(i>=128?(i=2147483647&this.getUint32(t),t+=3):i=this.getUint8(this.i++)|n<<8&16383),this.i=t+i,decoder.decode(new Uint8Array(this.buffer,this.byteOffset+t,i))}enum({intToStr:t}){let i=this.getUint8(this.i++);return i>64&&(i=i>=128?2147483647&this.getUint32((this.i+=3)-4):this.getUint8(this.i++)|i<<8&16383),t[i]??""}view(t=0){return new Uint8Array(this.buffer,this.byteOffset+(this.i+=t)-t,t)}get read(){return this.i}get remaining(){return this.byteLength-this.i}get overran(){return this.i>this.byteLength}toUint8Array(){return new Uint8Array(this.buffer,this.byteOffset+this.i,this.byteLength-this.i)}copyReadToArrayBuffer(){return this.buffer.slice(this.byteOffset,this.byteOffset+this.i)}copyRemainingToArrayBuffer(){return this.buffer.slice(this.byteOffset+this.i,this.byteOffset+this.byteLength)}copyToWriter(){return new BufWriter(this.buffer.slice(this.byteOffset,this.byteOffset+this.i),this.i)}copy(){return new BufReader(this.buffer.slice(this.byteOffset+this.i,this.byteOffset+this.byteLength))}[Symbol.for("nodejs.util.inspect.custom")](){let t=`BufReader(${this.byteLength-this.i}) [ \x1b[33m`,{i}=this,e=i+50>this.byteLength?this.byteLength:i+50;for(;i<e;){let s=this.getUint8(i++);t+=A[s>>4]+A[15&s]+" "}return t+`\x1b[m${this.byteLength>e?"... ":""}]`}}export class BufWriter{constructor(t=new ArrayBuffer(64),i=0){this.d=new DataView(t),this.x=new Uint8Array(t),this.i=i<=(this.cap=t.byteLength)?i:this.cap}_(t=0){let i=new Uint8Array(new ArrayBuffer(this.cap=(this.cap<<1)+t));i.set(this.x,0),this.d=new DataView(i.buffer),this.x=i}encode(t,i){return t.encode(this,i)}u8(t=0){this.i>=this.cap&&this._(),this.x[this.i++]=t}i8(t=0){this.i>=this.cap&&this._(),this.x[this.i++]=t}u16(t=0){(this.i+=2)>this.cap&&this._(),this.x[this.i-2]=t>>8,this.x[this.i-1]=t}i16(t=0){(this.i+=2)>this.cap&&this._(),this.x[this.i-2]=t>>8,this.x[this.i-1]=t}u32(t=0){(this.i+=4)>this.cap&&this._(),this.d.setUint32(this.i-4,t)}i32(t=0){(this.i+=4)>this.cap&&this._(),this.d.setInt32(this.i-4,t)}u64(e=0){(this.i+=8)>this.cap&&this._(),this.d.setUint32(this.i-8,t(i(e)/4294967296)),this.d.setInt32(this.i-4,0|e)}i64(e=0){(this.i+=8)>this.cap&&this._(),this.d.setInt32(this.i-8,t(i(e)/4294967296)),this.d.setInt32(this.i-4,0|e)}bu64(t=0){(this.i+=8)>this.cap&&this._(),this.d.setBigUint64(this.i-8,t)}bi64(t=0){(this.i+=8)>this.cap&&this._(),this.d.setBigInt64(this.i-8,t)}f32(t=0){(this.i+=4)>this.cap&&this._(),this.d.setFloat32(this.i-4,t)}f64(t=0){(this.i+=8)>this.cap&&this._(),this.d.setFloat64(this.i-8,t)}bool(t=!1){this.i>=this.cap&&this._(),this.x[this.i++]=t}v64(e=0){this.i>this.cap-8&&this._(),e>63?e>536870911?(this.d.setUint32((this.i+=8)-8,2147483648|t(i(e)/4294967296)),this.d.setInt32(this.i-4,0|e)):e>8191?this.d.setInt32((this.i+=4)-4,1610612736|e):(this.x[this.i++]=e>>8|64,this.x[this.i++]=e):this.x[this.i++]=e<0?0:e}bv64(t=0){this.i>this.cap-8&&this._();let i=Number(t);i>63?i>536870911?this.d.setBigUint64((this.i+=8)-8,0x8000000000000000n|t):i>8191n?this.d.setInt32((this.i+=4)-4,1610612736|i):(this.x[this.i++]=i>>8|64,this.x[this.i++]=i):this.x[this.i++]=i<0?0:i}v32(t=0){this.i>this.cap-4&&this._(),t>63?t>16383?this.d.setInt32((this.i+=4)-4,2147483648|t):(this.x[this.i++]=t>>8|64,this.x[this.i++]=t):this.x[this.i++]=t<0?0:t}v16(t=0){this.i>this.cap-2&&this._(),t>127?(this.x[this.i++]=t>>8|128,this.x[this.i++]=t):this.x[this.i++]=t>=0?t:0}u8arr(t,i=-1){if(!(t instanceof Uint8Array)){if(t instanceof BufWriter)t=t.x.subarray(0,t.i);else{this.i>=this.cap&&this._(),this.x[this.i++]=0;return}}if(i<0){if((i=t.byteLength)>2147483647){this.i>=this.cap&&this._(),this.x[this.i++]=0;return}this.i>this.cap-4-i&&this._(i),i>16383?i>2147483647?this.x[this.i++]=i=0:this.d.setInt32((this.i+=4)-4,2147483648|i):(i>63&&(this.x[this.i++]=i>>8|64),this.x[this.i++]=i)}else this.i>this.cap-i&&this._(i);this.x.set(t,this.i),this.i+=i}skip(t=0){(this.i+=t)>this.cap&&this._(t)}str(t=""){this.i>this.cap-4&&this._();let i=encoder.encode(t),e=i.length;if(e>2147483647){this.i>=this.cap&&this._(),this.x[this.i++]=0;return}this.i>this.cap-4-e&&this._(e),e>16383?e>2147483647?this.x[this.i++]=e=0:this.d.setInt32((this.i+=4)-4,2147483648|e):(e>63&&(this.x[this.i++]=e>>8|64),this.x[this.i++]=e),new Uint8Array(this.buffer).set(i,this.i),this.i+=e}enum({strToInt:t,default:i},e){this.i>this.cap-4&&this._();let s=t.get(e)??i;s>63?s>16383?this.d.setInt32((this.i+=4)-4,2147483648|s):(this.x[this.i++]=s>>8|64,this.x[this.i++]=s):this.x[this.i++]=s<0?0:s}get written(){return this.i}get buffer(){return this.d.buffer}get byteOffset(){return 0}get byteLength(){return this.i}toUint8Array(){return this.x.subarray(0,this.i)}toReader(){return new BufReader(this)}copyToArrayBuffer(){return this.x.buffer.slice(0,this.i)}copy(){return new BufWriter(this.d.buffer.slice(0,this.i),this.i)}copyToReader(){return new BufReader(this.x.buffer.slice(0,this.i))}[Symbol.for("nodejs.util.inspect.custom")](){let{i:t}=this,i=`BufWriter(${t}) [ ${t>50?(t-=50,"... "):(t=0,"")}\x1b[33m`;for(;t<this.i;){let e=this.x[t++];i+=A[e>>4]+A[15&e]+" "}return i+`\x1b[m]`}}"transfer"in ArrayBuffer.prototype&&(BufWriter.prototype._=function(t=0){this.d=new DataView(this.d.buffer.transfer(this.cap=(this.cap<<1)+t))});export const decoder=new TextDecoder,encoder=new TextEncoder,u8=E((t=0)=>("number"==typeof t?t:Number(t))&255,(t,i)=>t.u8(i),t=>t.u8(),1),i8=E((t=0)=>("number"==typeof t?t:Number(t))<<24>>24,(t,i)=>t.i8(i),t=>t.i8(),1),u16=E((t=0)=>("number"==typeof t?t:Number(t))&65535,(t,i)=>t.u16(i),t=>t.u16(),2),i16=E((t=0)=>("number"==typeof t?t:Number(t))<<16>>16,(t,i)=>t.i16(i),t=>t.i16(),2),u32=E((t=0)=>("number"==typeof t?t:Number(t))>>>0,(t,i)=>t.u32(i),t=>t.u32(),4),i32=E((t=0)=>("number"==typeof t?t:Number(t))|0,(t,i)=>t.i32(i),t=>t.i32(),4),u64=E((e=0)=>(t(i(e="number"==typeof e?e:Number(e))/4294967296)>>>0)*4294967296+(e>>>0),(t,i)=>t.u64(i),t=>t.u64(),8),i64=E((e=0)=>4294967296*t(i(e="number"==typeof e?e:Number(e))/4294967296)+(e>>>0),(t,i)=>t.i64(i),t=>t.i64(),8),bu64=E((t=0n)=>("bigint"==typeof t?t:BigInt(t))&0xffffffffffffffffn,(t,i)=>t.bu64(i),t=>t.bu64(),8),bi64=E((t=0n)=>BigInt.asIntN(64,typeof t=='bigint'?t:BigInt(t)),(t,i)=>t.bi64(i),t=>t.bi64(),8),f32=E((t=0)=>e("number"==typeof t?t:Number(t)),(t,i)=>t.f32(i),t=>t.f32(),4),f64=E((t=0)=>"number"==typeof t?t:Number(t),(t,i)=>t.f64(i),t=>t.f64(),8),v16=E((t=0)=>(t="number"==typeof t?t:Number(t))<0?0:32767&t,(t,i)=>t.v16(i),t=>t.v16(),1),v32=E((t=0)=>(t="number"==typeof t?t:Number(t))<0?0:2147483647&t,(t,i)=>t.v32(i),t=>t.v32(),1),v64=E((t=0)=>("number"==typeof t?t:Number(t))<0?0:t%0x7fffffffffffffff,(t,i)=>t.v32(i),t=>t.v32(),1),bv64=E((t=0n)=>("bigint"==typeof t?t:BigInt(t))<0n?0n:0x7fffffffffffffffn&t,(t,i)=>t.v32(i),t=>t.v32(),1),u8arr=E(t=>{try{let i="string"==typeof t?encoder.encode(t):new Uint8Array(t.buffer?t.buffer.slice(t.byteOffset,t.byteLength):t instanceof ArrayBuffer?t.slice(0,2147483647):t);return i.byteLength>2147483647?i.subarray(0,2147483647):i}catch{return new Uint8Array}},(t,i)=>t.u8arr(i),t=>t.u8arr(),1),str=E((t="")=>t+"",(t,i)=>t.str(i),t=>t.str(),1),bool=E(t=>!!t,(t,i)=>t.bool(i),t=>t.bool(),1),Arr=(i,e=-1)=>{(e=t(e))>=0||(e=-1);let s=E(t=>{let s=[];try{for(let r of t)s.push(i(r))}catch{}if(e>=0){if(s.length>e)s.length=e;else for(;s.length<e;)s.push(i())}else s.length>2147483647&&(s.length=2147483647);return s},(t,s=[])=>{let r=e<0?(t.v32(s.length),s.length):e;for(let h=0;h<r;h++)i.encode(t,s[h])},(t,s)=>{let r=e<0?t.v32():e;if(s)for(let h=0;h<r;h++)s[h]=i.decode(t,s[h]);else{s=[];for(let u=r;--u>=0;)s.push(i.decode(t))}return s},e<0?1:(i.size??0)*e);return s.of=(...t)=>s(t),s},Optional=t=>E(i=>null==i?null:t(i),(i,e)=>{null==e?i.u8(0):(i.u8(1),t.encode(i,e))},(i,e)=>i.u8()?t.decode(i,e):null,1),Enum=(t=[])=>{let i=new Map,e=[];if(Array.isArray(t))for(let s=0;s<t.length;s++)i.set(t[s]+"",s),e[s]=t[s];else for(let r in t){let h=2147483647&t[r];i.set(r,h),e[h]=r}let u=-1;for(;e[++u];);let x=E(t=>"string"==typeof t?i.get(t)??u:2147483647&Number(t),(t,e)=>t.v32("string"==typeof e?i.get(e)??u:e),t=>e[t.v32()]??"",1);return x.strToInt=i,x.intToStr=e,x.default=u,x},Padding=(t=0)=>E(_=>void 0,i=>i.skip(t),i=>void(i.i+=t),t);;u8arr.len=i=>((i=t(i))>=0||(i=0),E(t=>new Uint8Array(t instanceof ArrayBuffer?t.byteLength>=i?t.slice(0,i):i:t?.length===i?t:i),(t,e)=>t.u8arr(e,i),(t,e)=>t.u8arr(i),i));export let Struct=(t,i)=>{let e=[],s=[],r=[],h=[],u=[],$=0,o=0,f={};for(let c in t){let F=/^[a-zA-Z$_][a-zA-Z0-9$_]*$/.test(c)?c:JSON.stringify(c);e.push(F+":a"+$),s.push(F+":this.a"+$+"(a"+$+")"),r.push("this.a"+$+".encode(b,a"+$+")"),u.push(""+F+":this.a"+$+".decode(b)"),F=F.length==c.length?"v."+F:"v["+F+"]",h.push(F+"=this.a"+$+".decode(b,"+F+")"),o+=(f["a"+$++]=t[c]).size??0}let b=`return{${s}}`;return(i??=new Struct.constructor(`{${e}}={}`,b).bind(f)).encode=new Struct.constructor(`b,{${e}}={}`,r.join(";")).bind(f),i.decode=new Struct.constructor("b,v",`if(!v)return {${u}};${h.join(";")};return v`).bind(f),i.size=o,i.of=new Struct.constructor(Object.keys(f),b).bind(f),i};try{new Struct.constructor("")}catch{Struct=t=>E(i=>{let e={};for(let s in t)e[s]=t[s](i[s]);return e},(i,e={})=>{for(let s in t)t[s].encode(i,e[s])},(i,e={})=>{for(let s in t)e[s]=t[s].decode(i,e[s]);return e})}